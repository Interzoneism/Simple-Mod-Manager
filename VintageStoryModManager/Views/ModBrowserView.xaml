<UserControl
    x:Class="VintageStoryModManager.Views.ModBrowserView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="clr-namespace:VintageStoryModManager.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:design="clr-namespace:VintageStoryModManager.Design"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="http://schemas.modernwpf.com/2019"
    xmlns:views="clr-namespace:VintageStoryModManager.Views"
    xmlns:vm="clr-namespace:VintageStoryModManager.ViewModels"
    Padding="1,0,0,0"
    d:DataContext="{d:DesignInstance Type={x:Type design:ModBrowserViewDesignData},
                                     IsDesignTimeCreatable=True}"
    d:DesignHeight="786"
    d:DesignWidth="1311"
    Background="{DynamicResource Brush.Panel.Primary.Background.Solid}"
    Loaded="OnViewLoaded"
    mc:Ignorable="d">

    <UserControl.Resources>
        <converters:BooleanToVisibilityConverter x:Key="BoolToVisibility" />
        <converters:InvertBooleanConverter x:Key="InvertBoolean" />
        <converters:NullToVisibilityConverter x:Key="NullToVisibility" />
        <converters:SelectedToBorderBrushConverter x:Key="SelectedToBorder" />
        <converters:EqualityConverter x:Key="EqualityConverter" />
        <converters:CountToVisibilityConverter x:Key="CountToVisibility" />
        <converters:ContainsConverter x:Key="ContainsConverter" />
        <converters:BooleanToBrushConverter x:Key="BoolToBrush" />
        <converters:IconKeyToGeometryConverter x:Key="IconKeyToGeometry" />
        <converters:NoResultsVisibilityConverter x:Key="NoResultsVisibility" />
        <converters:FavoriteButtonVisibilityConverter x:Key="FavoriteButtonVisibility" />
        <converters:InstallButtonVisibilityConverter x:Key="InstallButtonVisibility" />
        <converters:FavoriteButtonShouldShowConverter x:Key="FavoriteButtonShouldShow" />
        <converters:InstallButtonShouldShowConverter x:Key="InstallButtonShouldShow" />

        <converters:ModNameAbbreviationConverter x:Key="ModNameAbbreviationConverter" />
        <converters:StringNullOrWhiteSpaceToVisibilityConverter x:Key="StringNullOrWhiteSpaceToVisibility" />
        <converters:StringToImageSourceConverter x:Key="StringToImageSource" />
        <converters:ThumbnailLayoutConverter x:Key="ThumbnailLayoutConverter" />

        <!--  Icon Path Styles using DarkVsTheme  -->
        <Style x:Key="IconSmall" TargetType="Path">
            <Setter Property="Width" Value="12" />
            <Setter Property="Height" Value="12" />
            <Setter Property="Stretch" Value="Uniform" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="Fill" Value="{DynamicResource Brush.Text.Subtle}" />
        </Style>

        <Style x:Key="IconSmallSubtle" TargetType="Path">
            <Setter Property="Width" Value="12" />
            <Setter Property="Height" Value="12" />
            <Setter Property="Stretch" Value="Uniform" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="Fill" Value="{DynamicResource Brush.Text.Subtle}" />
            <Setter Property="Opacity" Value="0.6" />
            <Setter Property="Margin" Value="0,0,4,0" />
        </Style>

        <Style x:Key="IconMedium" TargetType="Path">
            <Setter Property="Width" Value="14" />
            <Setter Property="Height" Value="14" />
            <Setter Property="Stretch" Value="Uniform" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="Fill" Value="{DynamicResource Brush.Text.Primary}" />
        </Style>

        <Style x:Key="IconLarge" TargetType="Path">
            <Setter Property="Width" Value="16" />
            <Setter Property="Height" Value="16" />
            <Setter Property="Stretch" Value="Uniform" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="Fill" Value="{DynamicResource Brush.Text.Primary}" />
        </Style>

        <!--  Mod Card Style using DarkVsTheme  -->
        <Style x:Key="ModCardStyle" TargetType="Border">
            <Setter Property="Background" Value="{DynamicResource Brush.ModCard.NoThumb}" />
            <Setter Property="BorderBrush" Value="{DynamicResource Brush.ModCard.Border.Gradient}" />
            <Setter Property="BorderThickness" Value="1,1,0,0" />
            <Setter Property="CornerRadius" Value="8,8,8,8" />
            <Setter Property="UseLayoutRounding" Value="True" />
            <Setter Property="SnapsToDevicePixels" Value="True" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="ClipToBounds" Value="True" />
            <Setter Property="RenderTransformOrigin" Value="0.5,0.5" />
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True" />
            </Style.Triggers>
        </Style>


    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!--  Filter Bar  -->
        <Border
            Margin="0,16,0,4"
            Padding="10,0,10,0"
            Background="{DynamicResource Brush.MiddleTab.Background.Selected}"
            BorderBrush="{DynamicResource Brush.Border.Default}"
            BorderThickness="0,0,0,1">
            <Grid UseLayoutRounding="False">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <WrapPanel
                    Margin="8,0,0,0"
                    HorizontalAlignment="Left"
                    Orientation="Horizontal">
                    <TextBox
                        Width="200"
                        Height="32"
                        Margin="0,0,4,0"
                        Padding="3,0,0,0"
                        ui:ControlHelper.PlaceholderText="Search..."
                        Style="{StaticResource IMM.SearchTextBoxStyle}"
                        Text="{Binding TextFilter, UpdateSourceTrigger=PropertyChanged}"
                        UseLayoutRounding="True" />
                    <ComboBox
                        Width="200"
                        Height="32"
                        Margin="4,0,4,0"
                        VerticalContentAlignment="Center"
                        ItemsSource="{Binding OrderByOptions, Mode=OneTime}"
                        SelectedValue="{Binding OrderBy}"
                        SelectedValuePath="Key"
                        UseLayoutRounding="True">
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <Path
                                        Width="12"
                                        Height="12"
                                        Margin="0,0,6,0"
                                        VerticalAlignment="Center"
                                        Data="{Binding Icon, Converter={StaticResource IconKeyToGeometry}}"
                                        Fill="{DynamicResource Brush.Text.Subtle}"
                                        Stretch="Uniform" />
                                    <TextBlock VerticalAlignment="Center" Text="{Binding Display}" />
                                </StackPanel>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>

                    <!--  Versions Filter using custom multi-select  -->
                    <views:MultiSelectDropdown
                        Width="160"
                        Height="32"
                        Margin="4"
                        DisplayMemberPath="Name"
                        ItemsSource="{Binding AvailableVersions}"
                        PlaceholderText="Versions"
                        SelectedItems="{Binding SelectedVersions}"
                        SelectionChanged="VersionsDropdown_SelectionChanged"
                        ToolTip="Select game versions to filter"
                        UseLayoutRounding="True" />

                    <!--  Tags Filter using custom multi-select  -->
                    <views:MultiSelectDropdown
                        Width="120"
                        Height="32"
                        Margin="4"
                        DisplayMemberPath="Name"
                        ItemsSource="{Binding AvailableTags}"
                        PlaceholderText="Tags"
                        SelectedItems="{Binding SelectedTags}"
                        SelectionChanged="TagsDropdown_SelectionChanged"
                        ToolTip="Select tags to filter"
                        UseLayoutRounding="True" />

                    <!--  Side Filter  -->
                    <ComboBox
                        Width="120"
                        Height="32"
                        Margin="4"
                        VerticalContentAlignment="Center"
                        DisplayMemberPath="Value"
                        ItemsSource="{Binding SideOptions, Mode=OneTime}"
                        SelectedValue="{Binding SelectedSide}"
                        SelectedValuePath="Key"
                        UseLayoutRounding="True" />

                    <!--  Installed Filter  -->
                    <ComboBox
                        Width="150"
                        Height="32"
                        Margin="4"
                        VerticalContentAlignment="Center"
                        DisplayMemberPath="Value"
                        ItemsSource="{Binding InstalledFilterOptions, Mode=OneTime}"
                        SelectedValue="{Binding SelectedInstalledFilter}"
                        SelectedValuePath="Key"
                        UseLayoutRounding="True" />
                    <Button
                        Width="32"
                        Height="32"
                        Margin="4,0,4,0"
                        Padding="0,0,0,0"
                        HorizontalContentAlignment="Center"
                        VerticalContentAlignment="Center"
                        Command="{Binding ToggleOrderDirectionCommand}"
                        Style="{StaticResource IconButtonStyle}"
                        ToolTip="Toggle sort direction"
                        UseLayoutRounding="True">
                        <Grid>
                            <Path
                                Width="12"
                                Height="12"
                                Data="{StaticResource IconChevronDown}"
                                Fill="{DynamicResource Brush.Text.Primary}"
                                Stretch="Uniform">
                                <Path.Style>
                                    <Style TargetType="{x:Type Path}">
                                        <Setter Property="Visibility" Value="Visible" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding OrderByDirection}" Value="asc">
                                                <Setter Property="Visibility" Value="Collapsed" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Path.Style>
                            </Path>
                            <Path
                                Width="12"
                                Height="12"
                                Data="{StaticResource IconChevronUp}"
                                Fill="{DynamicResource Brush.Text.Primary}"
                                Stretch="Uniform">
                                <Path.Style>
                                    <Style TargetType="{x:Type Path}">
                                        <Setter Property="Visibility" Value="Collapsed" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding OrderByDirection}" Value="asc">
                                                <Setter Property="Visibility" Value="Visible" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Path.Style>
                            </Path>
                        </Grid>
                    </Button>

                    <!--  Clear Filters  -->
                    <Button
                        Width="32"
                        Height="32"
                        Margin="4"
                        Command="{Binding ToggleRelevantSearchResultsCommand}"
                        Style="{StaticResource IconButtonStyle}"
                        ToolTip="Relevant Search Results"
                        UseLayoutRounding="True">
                        <Path Data="{StaticResource IconSearch}">
                            <Path.Style>
                                <Style BasedOn="{StaticResource IconLarge}" TargetType="Path">
                                    <Setter Property="Fill" Value="{DynamicResource Brush.Text.Subtle}" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding UseRelevantSearchResults}" Value="True">
                                            <Setter Property="Fill" Value="{DynamicResource Brush.Accent.Primary}" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Path.Style>
                        </Path>
                    </Button>
                    <Button
                        Width="32"
                        Height="32"
                        Margin="4"
                        Command="{Binding ClearFiltersCommand}"
                        Style="{StaticResource IconButtonStyle}"
                        ToolTip="Clear all filters"
                        UseLayoutRounding="True">
                        <Path Data="{StaticResource IconXCircle}" Style="{StaticResource IconLarge}" />
                    </Button>
                </WrapPanel>
                <StackPanel
                    Grid.Column="1"
                    Margin="0,4,8,0"
                    VerticalAlignment="Top"
                    Orientation="Horizontal">
                    <Button
                        Width="32"
                        Height="32"
                        Margin="0,0,4,0"
                        Command="{Binding ToggleFavoriteFilterCommand}"
                        Style="{StaticResource IconButtonStyle}"
                        ToolTip="Show only favorites"
                        UseLayoutRounding="True">
                        <Path
                            Width="16"
                            Height="16"
                            VerticalAlignment="Center"
                            Data="{StaticResource IconStarSolid}"
                            Stretch="Uniform">
                            <Path.Style>
                                <Style TargetType="{x:Type Path}">
                                    <Setter Property="Fill" Value="{DynamicResource Brush.Text.Subtle}" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding OnlyFavorites}" Value="True">
                                            <Setter Property="Fill" Value="#FBBF24" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Path.Style>
                        </Path>
                    </Button>

                    <Button
                        Width="32"
                        Height="32"
                        Margin="4,0,4,0"
                        HorizontalContentAlignment="Center"
                        Command="{Binding SearchModsCommand}"
                        IsEnabled="{Binding IsSearching, Converter={StaticResource InvertBoolean}}"
                        Style="{StaticResource IconButtonStyle}"
                        ToolTip="Refresh"
                        UseLayoutRounding="True">
                        <Path Data="{StaticResource IconRefresh}" Style="{StaticResource IconLarge}" />
                    </Button>
                    <Button
                        Width="32"
                        Height="32"
                        Margin="4,0,0,0"
                        Click="ScrollToTop_Click"
                        Style="{StaticResource IconButtonStyle}"
                        ToolTip="Scroll to top"
                        UseLayoutRounding="True">

                        <Path Data="{StaticResource IconArrowToTop}" Style="{StaticResource IconMedium}" />


                    </Button>
                </StackPanel>
            </Grid>
        </Border>
        <Border
            Grid.Row="1"
            Margin="16,0,16,0"
            Background="{DynamicResource Brush.ModBrowser.Background.Gradient}"
            CornerRadius="12,12,0,0">
            <ScrollViewer
                x:Name="ModsScrollViewer"
                HorizontalScrollBarVisibility="Disabled"
                ScrollChanged="ModsScrollViewer_ScrollChanged"
                VerticalScrollBarVisibility="Auto"
                PreviewMouseWheel="ModsScrollViewer_PreviewMouseWheel">
                <Grid>
                    <!--  Loading Indicator  -->
                    <StackPanel
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Visibility="{Binding IsSearching, Converter={StaticResource BoolToVisibility}}">
                        <!--  Progress Bar  -->
                        <ui:ProgressBar
                            Width="300"
                            Height="4"
                            IsIndeterminate="True" />
                        <TextBlock
                            Margin="0,16,0,0"
                            FontSize="14"
                            Foreground="{DynamicResource Brush.Text.Subtle}"
                            Text="{Binding LoadingMessage}"
                            TextAlignment="Center" />
                    </StackPanel>

                    <!--  No Results  -->
                    <TextBlock
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        FontSize="18"
                        Foreground="{DynamicResource Brush.Text.Subtle}"
                        Text="No mods found with the current filters and sorting options">
                        <TextBlock.Visibility>
                            <MultiBinding Converter="{StaticResource NoResultsVisibility}">
                                <Binding Path="IsSearching" />
                                <Binding Path="ModsList.Count" />
                            </MultiBinding>
                        </TextBlock.Visibility>
                    </TextBlock>

                    <!--  Mods Grid  -->
                    <ItemsControl
                        Margin="16,0,16,16"
                        ItemsSource="{Binding VisibleMods}"
                        RenderOptions.CachingHint="Cache"
                        Visibility="{Binding ModsList.Count, Converter={StaticResource CountToVisibility}}">
                        <ItemsControl.Effect>
                            <DropShadowEffect
                                BlurRadius="8"
                                Direction="310"
                                Opacity="0.2"
                                RenderingBias="Performance"
                                ShadowDepth="6" />
                        </ItemsControl.Effect>
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel HorizontalAlignment="Center" Orientation="Horizontal" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>

                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border
                                    x:Name="ModCardBorder"
                                    Width="344"
                                    Height="344"
                                    Margin="8"
                                    ClipToBounds="False"
                                    RenderOptions.CachingHint="Cache"
                                    Style="{StaticResource ModCardStyle}"
                                    Tag="{Binding ModId}"
                                    UseLayoutRounding="True">

                                    <Border.Triggers>
                                        <EventTrigger RoutedEvent="UIElement.MouseEnter">
                                            <BeginStoryboard>
                                                <Storyboard>
                                                    <DoubleAnimation
                                                        Storyboard.TargetName="ModCardHoverOverlay"
                                                        Storyboard.TargetProperty="Opacity"
                                                        To="0.10"
                                                        Duration="0:0:0.15">
                                                        <DoubleAnimation.EasingFunction>
                                                            <QuadraticEase EasingMode="EaseOut" />
                                                        </DoubleAnimation.EasingFunction>
                                                    </DoubleAnimation>
                                                </Storyboard>
                                            </BeginStoryboard>
                                        </EventTrigger>
                                        <EventTrigger RoutedEvent="UIElement.MouseLeave">
                                            <BeginStoryboard>
                                                <Storyboard>
                                                    <DoubleAnimation
                                                        Storyboard.TargetName="ModCardHoverOverlay"
                                                        Storyboard.TargetProperty="Opacity"
                                                        To="0"
                                                        Duration="0:0:0.2">
                                                        <DoubleAnimation.EasingFunction>
                                                            <QuadraticEase EasingMode="EaseIn" />
                                                        </DoubleAnimation.EasingFunction>
                                                    </DoubleAnimation>
                                                </Storyboard>
                                            </BeginStoryboard>
                                        </EventTrigger>
                                    </Border.Triggers>
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="*" />
                                            <RowDefinition Height="115" />
                                        </Grid.RowDefinitions>
                                        <!--  Image scaled so its width always matches the container while preserving aspect ratio  -->


                                        <Grid
                                            x:Name="ThumbContainer"
                                            Grid.Row="0"
                                            Grid.RowSpan="2">

                                            <WrapPanel x:Name="container" RenderOptions.BitmapScalingMode="LowQuality">

                                                <WrapPanel.OpacityMask>

                                                    <VisualBrush RenderOptions.CachingHint="Cache">
                                                        <VisualBrush.Visual>
                                                            <Border
                                                                Width="344"
                                                                Height="344"
                                                                Background="White"
                                                                CornerRadius="8" />
                                                        </VisualBrush.Visual>
                                                    </VisualBrush>
                                                </WrapPanel.OpacityMask>

                                                <Image
                                                    x:Name="ThumbImage"
                                                    Grid.Row="0"
                                                    MinHeight="229"
                                                    RenderOptions.BitmapScalingMode="LowQuality"
                                                    Source="{Binding LogoUrl, Converter={StaticResource StringToImageSource}, IsAsync=True}"
                                                    Stretch="Uniform"
                                                    Visibility="{Binding LogoUrl, ConverterParameter=invert, Converter={StaticResource StringNullOrWhiteSpaceToVisibility}}" />
                                            </WrapPanel>

                                        </Grid>

                                        <!--  Default Thumbnail Background - Shows when no thumbnail  -->
                                        <Image
                                            x:Name="DefaultThumbImage"
                                            Grid.Row="0"
                                            Grid.RowSpan="2"
                                            MinHeight="229"
                                            RenderOptions.BitmapScalingMode="LowQuality"
                                            Source="/Resources/mod-default.png"
                                            Stretch="UniformToFill">
                                            <Image.Style>
                                                <Style TargetType="{x:Type Image}">
                                                    <Setter Property="Opacity" Value="0" />
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding LogoUrl, Converter={StaticResource StringNullOrWhiteSpaceToVisibility}}" Value="Visible">
                                                            <Setter Property="Opacity" Value="0.5" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Image.Style>
                                        </Image>

                                        <!--  Hover Overlay  -->
                                        <Border
                                            x:Name="ModCardHoverOverlay"
                                            Grid.Row="0"
                                            Grid.RowSpan="2"
                                            Background="{DynamicResource Brush.ModCard.Hover.Bright}"
                                            CornerRadius="8"
                                            IsHitTestVisible="False"
                                            Opacity="0" />

                                        <!--  Abbreviation Text - DISABLED: Kept for future use but not displayed  -->
                                        <!--<Viewbox
                                            x:Name="AbbreviationViewbox"
                                            Grid.Row="0"
                                            Grid.RowSpan="1"
                                            HorizontalAlignment="Center"
                                            VerticalAlignment="Center"
                                            Stretch="Uniform"
                                            Visibility="Collapsed">
                                            <TextBlock
                                                Margin="2,2,2,2"
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"
                                                FontWeight="Bold"
                                                Foreground="{DynamicResource Brush.Text.Primary}"
                                                Text="{Binding Name, Converter={StaticResource ModNameAbbreviationConverter}}"
                                                TextAlignment="Center"
                                                TextWrapping="NoWrap" />
                                            <Viewbox.Style>
                                        -->
                                        <!--  NOTE: These animations are preserved but inactive due to Visibility="Collapsed" above  -->
                                        <!--
                                                <Style TargetType="Viewbox">
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding LogoUrl, Converter={StaticResource StringNullOrWhiteSpaceToVisibility}}" Value="Visible">
                                                            <DataTrigger.EnterActions>
                                                                <BeginStoryboard>
                                                                    <Storyboard>
                                                                        <DoubleAnimation
                                                                            BeginTime="0:0:0.15"
                                                                            Storyboard.TargetProperty="Opacity"
                                                                            To="1.0"
                                                                            Duration="0:0:0.20">
                                                                            <DoubleAnimation.EasingFunction>
                                                                                <CubicEase EasingMode="EaseInOut" />
                                                                            </DoubleAnimation.EasingFunction>
                                                                        </DoubleAnimation>
                                                                    </Storyboard>
                                                                </BeginStoryboard>
                                                            </DataTrigger.EnterActions>
                                                            <DataTrigger.ExitActions>
                                                                <BeginStoryboard>
                                                                    <Storyboard>
                                                                        <DoubleAnimation
                                                                            Storyboard.TargetProperty="Opacity"
                                                                            To="0"
                                                                            Duration="0:0:0.20">
                                                                            <DoubleAnimation.EasingFunction>
                                                                                <CubicEase EasingMode="EaseInOut" />
                                                                            </DoubleAnimation.EasingFunction>
                                                                        </DoubleAnimation>
                                                                    </Storyboard>
                                                                </BeginStoryboard>
                                                            </DataTrigger.ExitActions>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Viewbox.Style>
                                        </Viewbox>-->


                                        <!--  Overlay Buttons  -->
                                        <Grid Grid.Row="0" Grid.RowSpan="2">
                                            <!--  Favorite button on top left  -->
                                            <StackPanel
                                                Margin="8"
                                                HorizontalAlignment="Left"
                                                VerticalAlignment="Top"
                                                Orientation="Horizontal">
                                                <Button
                                                    x:Name="FavoriteButton"
                                                    Width="28"
                                                    Height="28"
                                                    Click="FavoriteButton_Click"
                                                    Tag="{Binding ModId}"
                                                    ToolTip="Toggle favorite">
                                                    <Button.Style>
                                                        <Style BasedOn="{StaticResource ModCardButtonStyle}" TargetType="{x:Type Button}">
                                                            <Setter Property="Opacity" Value="0" />
                                                            <Style.Triggers>
                                                                <DataTrigger Value="True">
                                                                    <DataTrigger.Binding>
                                                                        <MultiBinding Converter="{StaticResource FavoriteButtonShouldShow}">
                                                                            <Binding ElementName="ModCardBorder" Path="IsMouseOver" />
                                                                            <Binding Path="ModId" />
                                                                            <Binding Path="DataContext.FavoriteMods" RelativeSource="{RelativeSource AncestorType={x:Type UserControl}}" />
                                                                        </MultiBinding>
                                                                    </DataTrigger.Binding>
                                                                    <DataTrigger.EnterActions>
                                                                        <BeginStoryboard>
                                                                            <Storyboard>
                                                                                <DoubleAnimation
                                                                                    Storyboard.TargetProperty="Opacity"
                                                                                    To="0.9"
                                                                                    Duration="0:0:0.15">
                                                                                    <DoubleAnimation.EasingFunction>
                                                                                        <QuadraticEase EasingMode="EaseOut" />
                                                                                    </DoubleAnimation.EasingFunction>
                                                                                </DoubleAnimation>
                                                                            </Storyboard>
                                                                        </BeginStoryboard>
                                                                    </DataTrigger.EnterActions>
                                                                    <DataTrigger.ExitActions>
                                                                        <BeginStoryboard>
                                                                            <Storyboard>
                                                                                <DoubleAnimation
                                                                                    Storyboard.TargetProperty="Opacity"
                                                                                    To="0"
                                                                                    Duration="0:0:0.2">
                                                                                    <DoubleAnimation.EasingFunction>
                                                                                        <QuadraticEase EasingMode="EaseIn" />
                                                                                    </DoubleAnimation.EasingFunction>
                                                                                </DoubleAnimation>
                                                                            </Storyboard>
                                                                        </BeginStoryboard>
                                                                    </DataTrigger.ExitActions>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Button.Style>
                                                    <Path
                                                        Width="14"
                                                        Height="14"
                                                        VerticalAlignment="Center"
                                                        Data="{StaticResource IconStarSolid}"
                                                        Stretch="Uniform">
                                                        <Path.Style>
                                                            <Style TargetType="{x:Type Path}">
                                                                <Setter Property="Fill" Value="{DynamicResource Brush.Text.Subtle}" />
                                                                <Style.Triggers>
                                                                    <DataTrigger Value="True">
                                                                        <DataTrigger.Binding>
                                                                            <MultiBinding Converter="{StaticResource ContainsConverter}">
                                                                                <Binding Path="ModId" />
                                                                                <Binding Path="DataContext.FavoriteMods" RelativeSource="{RelativeSource AncestorType={x:Type UserControl}}" />
                                                                            </MultiBinding>
                                                                        </DataTrigger.Binding>
                                                                        <Setter Property="Fill" Value="#FBBF24" />
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Path.Style>
                                                    </Path>
                                                </Button>
                                            </StackPanel>

                                            <!--  Install button on top right  -->
                                            <StackPanel
                                                Margin="8"
                                                HorizontalAlignment="Right"
                                                VerticalAlignment="Top"
                                                Orientation="Horizontal">
                                                <Button
                                                    x:Name="InstallButton"
                                                    Width="28"
                                                    Height="28"
                                                    Click="InstallButton_Click"
                                                    IsEnabled="{Binding IsInstalled, Converter={StaticResource InvertBoolean}}"
                                                    Tag="{Binding ModId}"
                                                    ToolTip="Install mod">
                                                    <Button.Style>
                                                        <Style BasedOn="{StaticResource ModCardButtonStyle}" TargetType="{x:Type Button}">
                                                            <Setter Property="Opacity" Value="0" />
                                                            <Style.Triggers>
                                                                <DataTrigger Value="True">
                                                                    <DataTrigger.Binding>
                                                                        <MultiBinding Converter="{StaticResource InstallButtonShouldShow}">
                                                                            <Binding ElementName="ModCardBorder" Path="IsMouseOver" />
                                                                            <Binding Path="IsInstalled" />
                                                                        </MultiBinding>
                                                                    </DataTrigger.Binding>
                                                                    <DataTrigger.EnterActions>
                                                                        <BeginStoryboard>
                                                                            <Storyboard>
                                                                                <DoubleAnimation
                                                                                    Storyboard.TargetProperty="Opacity"
                                                                                    To="1"
                                                                                    Duration="0:0:0.15">
                                                                                    <DoubleAnimation.EasingFunction>
                                                                                        <QuadraticEase EasingMode="EaseOut" />
                                                                                    </DoubleAnimation.EasingFunction>
                                                                                </DoubleAnimation>
                                                                            </Storyboard>
                                                                        </BeginStoryboard>
                                                                    </DataTrigger.EnterActions>
                                                                    <DataTrigger.ExitActions>
                                                                        <BeginStoryboard>
                                                                            <Storyboard>
                                                                                <DoubleAnimation
                                                                                    Storyboard.TargetProperty="Opacity"
                                                                                    To="0"
                                                                                    Duration="0:0:0.2">
                                                                                    <DoubleAnimation.EasingFunction>
                                                                                        <QuadraticEase EasingMode="EaseIn" />
                                                                                    </DoubleAnimation.EasingFunction>
                                                                                </DoubleAnimation>
                                                                            </Storyboard>
                                                                        </BeginStoryboard>
                                                                    </DataTrigger.ExitActions>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Button.Style>
                                                    <Path
                                                        Width="14"
                                                        Height="14"
                                                        VerticalAlignment="Center"
                                                        Stretch="Uniform">
                                                        <Path.Style>
                                                            <Style TargetType="{x:Type Path}">
                                                                <Setter Property="Data" Value="{StaticResource IconDownload}" />
                                                                <Setter Property="Fill" Value="{DynamicResource Brush.Text.Primary}" />
                                                                <Style.Triggers>
                                                                    <!--  Show checkmark when installed  -->
                                                                    <DataTrigger Binding="{Binding IsInstalled}" Value="True">
                                                                        <Setter Property="Data" Value="{StaticResource IconCheck}" />
                                                                        <Setter Property="Fill" Value="{DynamicResource Brush.Status.Success}" />
                                                                    </DataTrigger>
                                                                    <!--  Show download icon when not installed  -->
                                                                    <DataTrigger Binding="{Binding IsInstalled}" Value="False">
                                                                        <Setter Property="Data" Value="{StaticResource IconDownload}" />
                                                                        <Setter Property="Fill" Value="{DynamicResource Brush.Text.Primary}" />
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Path.Style>
                                                    </Path>
                                                </Button>
                                            </StackPanel>


                                        </Grid>
                                        <Border
                                            Grid.Row="1"
                                            Height="115"
                                            Margin="0,0,0,-1"
                                            VerticalAlignment="Bottom"
                                            Background="{DynamicResource Brush.ModCard.InfoBox}"
                                            CornerRadius="0,0,8,8">
                                            <Grid x:Name="Infobox">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*" />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>

                                                <!--  Title & Description  -->
                                                <StackPanel Grid.Column="0" Margin="18,8,4,8">
                                                    <!--  MaxWidth: Card=288 - StatsColumn(80+16)=96 - Separator=1 - Margins=16 = 175  -->
                                                    <StackPanel
                                                        MaxWidth="220"
                                                        HorizontalAlignment="Left"
                                                        Orientation="Vertical">
                                                        <!--  MaxWidth: 175 - LinkIcon(10+4margin) = 161  -->
                                                        <TextBlock
                                                            MaxWidth="210"
                                                            HorizontalAlignment="Left"
                                                            Cursor="Hand"
                                                            FontSize="21"
                                                            FontWeight="Light"
                                                            Foreground="{DynamicResource Brush.Text.Primary}"
                                                            MouseLeftButtonDown="OpenInBrowserTitle_Click"
                                                            Tag="{Binding AssetId}"
                                                            Text="{Binding Name}"
                                                            TextTrimming="CharacterEllipsis"
                                                            ToolTip="Open in browser">
                                                            <TextBlock.Style>
                                                                <Style TargetType="{x:Type TextBlock}">
                                                                    <Style.Triggers>
                                                                        <Trigger Property="IsMouseOver" Value="True">
                                                                            <Setter Property="TextDecorations" Value="Underline" />
                                                                        </Trigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </TextBlock.Style>
                                                        </TextBlock>
                                                        <StackPanel Orientation="Horizontal">
                                                            <Path Data="{StaticResource IconUser}" Style="{StaticResource IconSmallSubtle}" />
                                                            <!--  MaxWidth: StatsWidth=80 - Icon(12+4margin) = 64  -->
                                                            <TextBlock
                                                                MaxWidth="128"
                                                                FontSize="12"
                                                                Foreground="{DynamicResource Brush.Text.Primary}"
                                                                Text="{Binding Author}"
                                                                TextTrimming="CharacterEllipsis" />
                                                        </StackPanel>

                                                    </StackPanel>
                                                    <TextBlock
                                                        MaxHeight="60"
                                                        FontWeight="Normal"
                                                        Foreground="{DynamicResource Brush.Text.Subtle}"
                                                        Text="{Binding Summary}"
                                                        TextTrimming="CharacterEllipsis"
                                                        TextWrapping="Wrap" />
                                                </StackPanel>



                                                <!--  Stats  -->
                                                <StackPanel
                                                    Grid.Column="1"
                                                    Width="80"
                                                    Margin="8,16,8,8">
                                                    <StackPanel Margin="0,2" Orientation="Horizontal">
                                                        <Path Data="{StaticResource IconDownload}" Style="{StaticResource IconSmallSubtle}" />
                                                        <TextBlock
                                                            FontSize="12"
                                                            Foreground="{DynamicResource Brush.Text.Primary}"
                                                            Text="{Binding FormattedDownloads}" />
                                                    </StackPanel>
                                                    <StackPanel Margin="0,2" Orientation="Horizontal">
                                                        <Path Data="{StaticResource IconHeartSolid}" Style="{StaticResource IconSmallSubtle}" />
                                                        <TextBlock
                                                            FontSize="12"
                                                            Foreground="{DynamicResource Brush.Text.Primary}"
                                                            Text="{Binding FormattedFollows}" />
                                                    </StackPanel>
                                                    <StackPanel Margin="0,2" Orientation="Horizontal">
                                                        <Path Data="{StaticResource IconMessage}" Style="{StaticResource IconSmallSubtle}" />
                                                        <TextBlock
                                                            FontSize="12"
                                                            Foreground="{DynamicResource Brush.Text.Primary}"
                                                            Text="{Binding FormattedComments}" />
                                                    </StackPanel>
                                                </StackPanel>
                                            </Grid>
                                        </Border>



                                        <Border
                                            x:Name="UserReports"
                                            Grid.Row="0"
                                            Margin="0,0,8,8"
                                            Padding="6,4"
                                            HorizontalAlignment="Right"
                                            VerticalAlignment="Bottom"
                                            Background="{DynamicResource Brush.Panel.Secondary.Background.Solid}"
                                            CornerRadius="6"
                                            Visibility="{Binding ShowUserReportBadge, Converter={StaticResource IMM.BooleanToVisibilityConverter}}">
                                            <TextBlock
                                                FontSize="12"
                                                FontWeight="SemiBold"
                                                Foreground="{DynamicResource Brush.Text.Primary}"
                                                Text="{Binding UserReportDisplay}"
                                                TextTrimming="CharacterEllipsis"
                                                ToolTip="{Binding UserReportTooltip}" />
                                        </Border>

                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </Grid>
            </ScrollViewer>
        </Border>

        <!--  Mod Grid  -->
    </Grid>
</UserControl>
